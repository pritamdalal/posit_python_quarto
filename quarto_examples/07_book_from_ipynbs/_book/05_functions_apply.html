<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python for Data Wrangling in Finance - 5&nbsp; Functions and DataFrame.apply() Method</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06_merge.html" rel="next">
<link href="./04_query.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Functions and <code>DataFrame.apply()</code> Method</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Python for Data Wrangling in Finance</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_jumpstart.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Python Jumpstart</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_dataframe_basics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Basics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_index_slice.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Indexing and Slicing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_query.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Querying</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_functions_apply.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Functions and <code>DataFrame.apply()</code> Method</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_merge.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Merging <code>DataFrames</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_groupby_aggregation_part_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><code>.groupby()</code> and <code>.agg()</code> - Part 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_groupby_aggregation_part_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title"><code>.groupby()</code> and <code>.agg()</code> - Part 2</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#defining-functions" id="toc-defining-functions" class="nav-link active" data-scroll-target="#defining-functions"><span class="toc-section-number">5.1</span>  Defining Functions</a></li>
  <li><a href="#option-payoff-function" id="toc-option-payoff-function" class="nav-link" data-scroll-target="#option-payoff-function"><span class="toc-section-number">5.2</span>  Option Payoff Function</a></li>
  <li><a href="#loading-packages" id="toc-loading-packages" class="nav-link" data-scroll-target="#loading-packages"><span class="toc-section-number">5.3</span>  Loading Packages</a></li>
  <li><a href="#reading-in-data" id="toc-reading-in-data" class="nav-link" data-scroll-target="#reading-in-data"><span class="toc-section-number">5.4</span>  Reading-In Data</a></li>
  <li><a href="#initializing-payoff-columns" id="toc-initializing-payoff-columns" class="nav-link" data-scroll-target="#initializing-payoff-columns"><span class="toc-section-number">5.5</span>  Initializing Payoff Columns</a></li>
  <li><a href="#calculate-option_payoff-via-for-loop" id="toc-calculate-option_payoff-via-for-loop" class="nav-link" data-scroll-target="#calculate-option_payoff-via-for-loop"><span class="toc-section-number">5.6</span>  Calculate <code>option_payoff</code> via <code>for</code> loop</a></li>
  <li><a href="#calculate-opt_pay-via-.apply" id="toc-calculate-opt_pay-via-.apply" class="nav-link" data-scroll-target="#calculate-opt_pay-via-.apply"><span class="toc-section-number">5.7</span>  Calculate <code>opt_pay</code> via <code>.apply()</code></a></li>
  <li><a href="#related-reading" id="toc-related-reading" class="nav-link" data-scroll-target="#related-reading"><span class="toc-section-number">5.8</span>  Related Reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Functions and <code>DataFrame.apply()</code> Method</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>We have already discussed how to add a new column to a <code>DataFrame</code> that is a simple function of existing columns.</p>
<p>Suppose the situation is a little more complicated, and that the column we want to add is some kind of custom (user defined) function of existing columns.</p>
<p>In this tutorial we discuss two ways of doing this:</p>
<ol type="1">
<li><p>A <code>for</code> loop</p></li>
<li><p><code>DataFrame.apply()</code></p></li>
</ol>
<p>We will use a finance task to motivate these two techniques: calculating the payoffs of expiring options.</p>
<section id="defining-functions" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="defining-functions"><span class="header-section-number">5.1</span> Defining Functions</h2>
<p>Defining functions in Python is straightforward. They syntax is simply <code>def function_name(arguments):</code>. The following function squares two numbers.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> square(x):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    sq <span class="op">=</span> x <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(sq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s verify that our function works:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(square(<span class="dv">2</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(square(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4
25</code></pre>
</div>
</div>
<p><strong>Code Challenge:</strong> Write a <code>cube()</code> function that cubes a number, and along the way, verify that indentation is required after the <code>def</code> statement.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cube(x):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    cb <span class="op">=</span> x <span class="op">**</span> <span class="dv">3</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(cb)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cube(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>27</code></pre>
</div>
</div>
</section>
<section id="option-payoff-function" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="option-payoff-function"><span class="header-section-number">5.2</span> Option Payoff Function</h2>
<p>Let’s now write a more financially interesting function.</p>
<p>Options are insurance contracts that are written on top of an underlying stock, much like car insurance is written <em>on top</em> of your car. There are two types of options: <em>puts</em> and <em>calls</em>. Put options protect you from the stock price going too low, while call options protect you from the stock price going too high. Both types have a feature called a <em>strike</em> price, which acts much like the deductable of your car insurance. Options expire sometime in the future, and the payoff (payout) of the option at the time of the expiration is as follows:</p>
<p>Let <span class="math inline">\(K\)</span> be the strike price of an option, and let <span class="math inline">\(S_{T}\)</span> price of its underlying at the time of expiration. Then the payoff of each type of option is as follows:</p>
<ol type="1">
<li><p><strong>call</strong>: <span class="math inline">\(\max(S_T - K, 0)\)</span></p></li>
<li><p><strong>put</strong>: <span class="math inline">\(\max(K - S_T, 0)\)</span></p></li>
</ol>
<p>We can codify this as follows:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> option_payoff(cp, strike, upx):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cp <span class="op">==</span> <span class="st">'call'</span>:</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        payoff <span class="op">=</span> <span class="bu">max</span>(upx <span class="op">-</span> strike, <span class="dv">0</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> cp <span class="op">==</span> <span class="st">'put'</span>:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        payoff <span class="op">=</span> <span class="bu">max</span>(strike <span class="op">-</span> upx, <span class="dv">0</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> payoff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s verify that our function works:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(option_payoff(<span class="st">"call"</span>, <span class="dv">100</span>, <span class="dv">110</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(option_payoff(<span class="st">"put"</span>, <span class="dv">100</span>, <span class="dv">110</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(option_payoff(<span class="st">"call"</span>, <span class="dv">100</span>, <span class="dv">90</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(option_payoff(<span class="st">"put"</span>, <span class="dv">100</span>, <span class="dv">90</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10
0
0
10</code></pre>
</div>
</div>
</section>
<section id="loading-packages" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="loading-packages"><span class="header-section-number">5.3</span> Loading Packages</h2>
<p>Let’s now load the packages that we will need.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reading-in-data" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="reading-in-data"><span class="header-section-number">5.4</span> Reading-In Data</h2>
<p>Next, let’s read in a data file called <code>spy_expiring_options.csv</code>.</p>
<p>This data set consists of 21 different options on <code>SPY</code> that expired on November 16, 2018.</p>
<p>The <code>upx</code> column is the settle price of <code>SPY</code> from that day, and it will be used to calculate the payoff of each of these options.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_opt <span class="op">=</span> pd.read_csv(<span class="st">"spy_expiring_options.csv"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df_opt <span class="op">=</span> df_opt.<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df_opt.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>underlying</th>
      <th>upx</th>
      <th>type</th>
      <th>expiration</th>
      <th>data_date</th>
      <th>strike</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>272.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="initializing-payoff-columns" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="initializing-payoff-columns"><span class="header-section-number">5.5</span> Initializing Payoff Columns</h2>
<p>Our ultimate objective is to add a column of option payoffs to <code>df_opt</code>. We are going to accomplish this task using two different methods: (1) a <code>for</code> loop; (2) the <code>DataFrame.apply()</code> method.</p>
<p>As a first step, let’s add two columns to <code>df_opt</code>, one for each method, and then initialize them both with <code>np.nan</code>, which is a special data type that represents missing numerical data.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_opt[<span class="st">'payoff_loop'</span>] <span class="op">=</span> np.nan</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df_opt[<span class="st">'payoff_apply'</span>] <span class="op">=</span> np.nan</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_opt.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>underlying</th>
      <th>upx</th>
      <th>type</th>
      <th>expiration</th>
      <th>data_date</th>
      <th>strike</th>
      <th>payoff_loop</th>
      <th>payoff_apply</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.5</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.5</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>272.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="calculate-option_payoff-via-for-loop" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="calculate-option_payoff-via-for-loop"><span class="header-section-number">5.6</span> Calculate <code>option_payoff</code> via <code>for</code> loop</h2>
<p>Let’s iterate through <code>df_opt</code> with a <code>for</code> loop and calculate the payoffs one by one. Notice that we are useing the <code>.at</code> indexer which is specifically designed to grab a single value from a column.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ix <span class="kw">in</span> df_opt.index:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grabbing data from dataframe</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    opt_type <span class="op">=</span> df_opt.at[ix, <span class="st">'type'</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    strike <span class="op">=</span> df_opt.at[ix, <span class="st">'strike'</span>]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    upx <span class="op">=</span> df_opt.at[ix, <span class="st">'upx'</span>]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculating payoff</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    payoff <span class="op">=</span> option_payoff(opt_type, strike, upx)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># writing payoff to dataframe</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    df_opt.at[ix, <span class="st">'payoff_loop'</span>] <span class="op">=</span> payoff</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>df_opt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>underlying</th>
      <th>upx</th>
      <th>type</th>
      <th>expiration</th>
      <th>data_date</th>
      <th>strike</th>
      <th>payoff_loop</th>
      <th>payoff_apply</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.0</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.5</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.0</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.5</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>272.0</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>272.5</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>273.0</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>273.5</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>274.0</td>
      <td>0.27</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>274.5</td>
      <td>0.77</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>10</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>275.0</td>
      <td>1.27</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>275.5</td>
      <td>1.77</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>276.0</td>
      <td>2.27</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>276.5</td>
      <td>2.77</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>277.0</td>
      <td>3.27</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>277.5</td>
      <td>3.77</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>16</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>278.0</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>17</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>278.5</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>18</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>279.0</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>19</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>279.5</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>20</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>280.0</td>
      <td>0.00</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="calculate-opt_pay-via-.apply" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="calculate-opt_pay-via-.apply"><span class="header-section-number">5.7</span> Calculate <code>opt_pay</code> via <code>.apply()</code></h2>
<p>The <code>DataFrame.apply()</code> method allows us to perform these calculations without explicitly iterating through <code>df_opt</code> with a <code>for</code> loop. It is a way to <em>vectorize</em> user defined functions.</p>
<p>In order to make use of <code>.apply()</code>, we will have to construct our custom payoff function slightly differently. The following <code>opt_pay()</code> function expects as its argument the row of a <code>DataFrame</code>:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> opt_pay(row):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># reading function inputs from DataFrame row</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    cp <span class="op">=</span> row[<span class="st">'type'</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    strike <span class="op">=</span> row[<span class="st">'strike'</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    upx <span class="op">=</span> row[<span class="st">'upx'</span>]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># option payoff logic</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cp <span class="op">==</span> <span class="st">'call'</span>:</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        payoff <span class="op">=</span> <span class="bu">max</span>(upx <span class="op">-</span> strike, <span class="dv">0</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> cp <span class="op">==</span> <span class="st">'put'</span>:</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        payoff <span class="op">=</span> <span class="bu">max</span>(strike <span class="op">-</span> upx, <span class="dv">0</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> payoff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use <code>.apply()</code> to calculate the payoffs in a single line of code.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_opt[<span class="st">'payoff_apply'</span>] <span class="op">=</span> df_opt.<span class="bu">apply</span>(opt_pay, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df_opt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>underlying</th>
      <th>upx</th>
      <th>type</th>
      <th>expiration</th>
      <th>data_date</th>
      <th>strike</th>
      <th>payoff_loop</th>
      <th>payoff_apply</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.5</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.5</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>272.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>272.5</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>273.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>273.5</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>8</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>274.0</td>
      <td>0.27</td>
      <td>0.27</td>
    </tr>
    <tr>
      <th>9</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>274.5</td>
      <td>0.77</td>
      <td>0.77</td>
    </tr>
    <tr>
      <th>10</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>275.0</td>
      <td>1.27</td>
      <td>1.27</td>
    </tr>
    <tr>
      <th>11</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>275.5</td>
      <td>1.77</td>
      <td>1.77</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>276.0</td>
      <td>2.27</td>
      <td>2.27</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>276.5</td>
      <td>2.77</td>
      <td>2.77</td>
    </tr>
    <tr>
      <th>14</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>277.0</td>
      <td>3.27</td>
      <td>3.27</td>
    </tr>
    <tr>
      <th>15</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>277.5</td>
      <td>3.77</td>
      <td>3.77</td>
    </tr>
    <tr>
      <th>16</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>278.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>17</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>278.5</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>18</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>279.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>19</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>279.5</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>20</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>280.0</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><strong>Code Challenge:</strong> Add a column to <code>df_opt</code> that identifies if the <code>upx</code> is bigger or smaller than <code>strike</code>. Do this by writing a custom function and then using <code>DataFrame.apply()</code>.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> big_small(row):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    upx <span class="op">=</span> row[<span class="st">'upx'</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    strike <span class="op">=</span> row[<span class="st">'strike'</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> upx <span class="op">&gt;=</span> strike:</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>(<span class="st">'bigger'</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>(<span class="st">'smaller'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_opt[<span class="st">'big_small'</span>] <span class="op">=</span> df_opt.<span class="bu">apply</span>(big_small, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df_opt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>underlying</th>
      <th>upx</th>
      <th>type</th>
      <th>expiration</th>
      <th>data_date</th>
      <th>strike</th>
      <th>payoff_loop</th>
      <th>payoff_apply</th>
      <th>big_small</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>bigger</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>270.5</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>bigger</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>bigger</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>271.5</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>bigger</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>272.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>bigger</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>272.5</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>bigger</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>273.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>bigger</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>273.5</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>bigger</td>
    </tr>
    <tr>
      <th>8</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>274.0</td>
      <td>0.27</td>
      <td>0.27</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>9</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>274.5</td>
      <td>0.77</td>
      <td>0.77</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>10</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>275.0</td>
      <td>1.27</td>
      <td>1.27</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>11</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>275.5</td>
      <td>1.77</td>
      <td>1.77</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>276.0</td>
      <td>2.27</td>
      <td>2.27</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>276.5</td>
      <td>2.77</td>
      <td>2.77</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>14</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>277.0</td>
      <td>3.27</td>
      <td>3.27</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>15</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>put</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>277.5</td>
      <td>3.77</td>
      <td>3.77</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>16</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>278.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>17</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>278.5</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>18</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>279.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>19</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>279.5</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>smaller</td>
    </tr>
    <tr>
      <th>20</th>
      <td>SPY</td>
      <td>273.73</td>
      <td>call</td>
      <td>2018-11-16</td>
      <td>2018-11-16</td>
      <td>280.0</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>smaller</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="related-reading" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="related-reading"><span class="header-section-number">5.8</span> Related Reading</h2>
<p><em>WTP</em> - 8 - Control Flow</p>
<p><em>WTP</em> - 9 - Defining Functions</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04_query.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><code>DataFrame</code> Querying</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06_merge.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Merging <code>DataFrames</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>